fixtures:
  - id: F01_OVERSOLD_BEAR_ADX_WEAK_WAIT
    description: "Oversold + bear regime + ADX weak => WAIT (avoid sell into exhaustion)."
    inputs:
      ticker: "TEST1"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 311.0
      ema_50: 318.0
      sma_200: 242.0
      rsi_14: 28.0
      macd: -1.0
      macd_signal: 0.0
      stoch_k: 10.0
      adx_14: 16.0
      vroc_14: 5.0
      atr_pct: 3.5
      supertrend_dir_1D: "BEAR"
      supertrend_dir_1W: "BEAR"
    expected:
      regime_1D: "BEAR"
      regime_1W: "BEAR"
      action_final: "WAIT"
      gates_triggered: ["G_OVERSOLD_BOUNCE"]
      conflicts_contains: ["OVERSOLD_BOUNCE_RISK"]
      confidence_cap_max: 60

  - id: F02_OVERSOLD_BEAR_ADX_STRONG_REDUCE_LOWCONF
    description: "Oversold but strong aligned downtrend => REDUCE allowed via exception; confidence capped."
    inputs:
      ticker: "TEST2"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 311.0
      ema_50: 318.0
      sma_200: 242.0
      rsi_14: 29.0
      macd: -2.0
      macd_signal: -1.0
      stoch_k: 12.0
      adx_14: 32.0
      vroc_14: 25.0
      atr_pct: 3.5
      supertrend_dir_1D: "BEAR"
      supertrend_dir_1W: "BEAR"
    expected:
      regime_1D: "BEAR"
      regime_1W: "BEAR"
      action_final: "REDUCE"
      gates_triggered: ["G_OVERSOLD_BOUNCE"]
      conflicts_contains: ["OVERSOLD_BOUNCE_RISK"]
      confidence_cap_max: 70

  - id: F03_OVERBOUGHT_BULL_ADX_STRONG_WAIT
    description: "Overbought in strong bull => WAIT (avoid chase)."
    inputs:
      ticker: "TEST3"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 340.0
      ema_50: 320.0
      sma_200: 250.0
      rsi_14: 74.0
      macd: 5.0
      macd_signal: 3.0
      stoch_k: 97.0
      adx_14: 34.0
      vroc_14: 22.0
      atr_pct: 2.0
      supertrend_dir_1D: "BULL"
      supertrend_dir_1W: "BULL"
    expected:
      regime_1D: "BULL"
      regime_1W: "BULL"
      action_final: "WAIT"
      gates_triggered: ["G_OVERBOUGHT_CHASE"]
      conflicts_contains: ["OVERBOUGHT_PULLBACK_RISK"]
      confidence_cap_max: 70

  - id: F04_DAILY_BEAR_WEEKLY_BULL_WAIT
    description: "Daily BEAR but Weekly BULL => TIMEFRAME_CONFLICT => WAIT."
    inputs:
      ticker: "TEST4"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 305.0
      ema_50: 318.0
      sma_200: 250.0
      rsi_14: 40.0
      macd: -1.0
      macd_signal: 0.0
      stoch_k: 35.0
      adx_14: 22.0
      vroc_14: 10.0
      atr_pct: 3.0
      supertrend_dir_1D: "BEAR"
      supertrend_dir_1W: "BULL"
    expected:
      regime_1D: "BEAR"
      regime_1W: "BULL"
      action_final: "WAIT"
      gates_triggered: ["G_TIMEFRAME_CONFLICT"]
      conflicts_contains: ["TIMEFRAME_CONFLICT"]
      confidence_cap_max: 60

  - id: F05_DAILY_BULL_WEEKLY_BEAR_WAIT
    description: "Daily BULL but Weekly BEAR => TIMEFRAME_CONFLICT => WAIT."
    inputs:
      ticker: "TEST5"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 260.0
      ema_50: 255.0
      sma_200: 270.0
      rsi_14: 55.0
      macd: 1.0
      macd_signal: 0.5
      stoch_k: 60.0
      adx_14: 24.0
      vroc_14: 15.0
      atr_pct: 3.0
      supertrend_dir_1D: "BULL"
      supertrend_dir_1W: "BEAR"
    expected:
      regime_1D: "BULL"
      regime_1W: "BEAR"
      action_final: "WAIT"
      gates_triggered: ["G_TIMEFRAME_CONFLICT"]
      conflicts_contains: ["TIMEFRAME_CONFLICT"]
      confidence_cap_max: 60

  - id: F06_ATR_EXTREME_CAP_CONF
    description: "ATR% EXTREME => HIGH_VOLATILITY gate triggers; confidence capped; WAIT."
    inputs:
      ticker: "TEST6"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 200.0
      ema_50: 210.0
      sma_200: 220.0
      rsi_14: 50.0
      macd: -0.5
      macd_signal: -0.2
      stoch_k: 50.0
      adx_14: 20.0
      vroc_14: 5.0
      atr_pct: 6.5
      supertrend_dir_1D: "BEAR"
      supertrend_dir_1W: "BEAR"
    expected:
      regime_1D: "BEAR"
      regime_1W: "BEAR"
      action_final: "WAIT"
      gates_triggered: ["G_HIGH_VOL"]
      conflicts_contains: ["HIGH_VOLATILITY"]
      confidence_cap_max: 55

  - id: F07_VROC_FALLING_LOW_PARTICIPATION
    description: "VROC falling => LOW_PARTICIPATION gate triggers; WAIT; confidence capped."
    inputs:
      ticker: "TEST7"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 320.0
      ema_50: 315.0
      sma_200: 260.0
      rsi_14: 60.0
      macd: 2.0
      macd_signal: 1.5
      stoch_k: 70.0
      adx_14: 26.0
      vroc_14: -15.0
      atr_pct: 2.8
      supertrend_dir_1D: "BULL"
      supertrend_dir_1W: "BULL"
    expected:
      regime_1D: "BULL"
      regime_1W: "BULL"
      action_final: "WAIT"
      gates_triggered: ["G_LOW_PARTICIPATION"]
      conflicts_contains: ["LOW_PARTICIPATION"]
      confidence_cap_max: 65

  - id: F08_SUPERTREND_FLIP_BUT_MA_BULL_NEUTRAL
    description: "Supertrend 1D BEAR but price above EMA50 & SMA200 => regime_1D NEUTRAL; weekly BULL => conflict => WAIT."
    inputs:
      ticker: "TEST8"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 320.0
      ema_50: 310.0
      sma_200: 250.0
      rsi_14: 58.0
      macd: 1.0
      macd_signal: 0.8
      stoch_k: 55.0
      adx_14: 19.0
      vroc_14: 12.0
      atr_pct: 2.6
      supertrend_dir_1D: "BEAR"
      supertrend_dir_1W: "BULL"
    expected:
      regime_1D: "NEUTRAL"
      regime_1W: "BULL"
      action_final: "WAIT"
      gates_triggered: ["G_TIMEFRAME_CONFLICT"]
      conflicts_contains: ["TIMEFRAME_CONFLICT"]
      confidence_cap_max: 60

  - id: F09_MACD_BULL_BUT_WEAK_RSI_STOCH_MIXED_WAIT
    description: "MACD bull but RSI weak and Stoch low; regime BEAR/BEAR => WAIT."
    inputs:
      ticker: "TEST9"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 310.0
      ema_50: 312.0
      sma_200: 260.0
      rsi_14: 42.0
      macd: 0.6
      macd_signal: 0.4
      stoch_k: 18.0
      adx_14: 20.0
      vroc_14: 8.0
      atr_pct: 3.2
      supertrend_dir_1D: "BEAR"
      supertrend_dir_1W: "BEAR"
    expected:
      regime_1D: "BEAR"
      regime_1W: "BEAR"
      action_final: "WAIT"
      gates_triggered: []
      conflicts_contains: []
      confidence_cap_max: 60

  - id: F10_ALL_ALIGNED_BULL_ACCUMULATE
    description: "All aligned bull => ACCUMULATE."
    inputs:
      ticker: "TEST10"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 330.0
      ema_50: 310.0
      sma_200: 260.0
      rsi_14: 62.0
      macd: 3.0
      macd_signal: 2.0
      stoch_k: 60.0
      adx_14: 30.0
      vroc_14: 25.0
      atr_pct: 2.0
      supertrend_dir_1D: "BULL"
      supertrend_dir_1W: "BULL"
    expected:
      regime_1D: "BULL"
      regime_1W: "BULL"
      action_final: "ACCUMULATE"
      gates_triggered: []
      conflicts_contains: []
      confidence_cap_max: 85

  - id: F11_ALL_ALIGNED_BEAR_REDUCE
    description: "All aligned bear => REDUCE."
    inputs:
      ticker: "TEST11"
      as_of: "2026-02-11T12:00:00-05:00"
      price_last: 240.0
      ema_50: 260.0
      sma_200: 280.0
      rsi_14: 38.0
      macd: -3.0
      macd_signal: -2.0
      stoch_k: 40.0
      adx_14: 33.0
      vroc_14: 22.0
      atr_pct: 2.5
      supertrend_dir_1D: "BEAR"
      supertrend_dir_1W: "BEAR"
    expected:
      regime_1D: "BEAR"
      regime_1W: "BEAR"
      action_final: "REDUCE"
      gates_triggered: []
      conflicts_contains: []
      confidence_cap_max: 85

  - id: F12_DATA_STALE_DEGRADED_WAIT
    description: "Stale data => WAIT; confidence capped <=55 using now_iso in tests."
    inputs:
      ticker: "TEST12"
      as_of: "2026-02-10T06:00:00-05:00"
      price_last: 300.0
      ema_50: 295.0
      sma_200: 250.0
      rsi_14: 55.0
      macd: 1.0
      macd_signal: 0.8
      stoch_k: 50.0
      adx_14: 22.0
      vroc_14: 10.0
      atr_pct: 3.0
      supertrend_dir_1D: "BULL"
      supertrend_dir_1W: "BULL"
    expected:
      regime_1D: "BULL"
      regime_1W: "BULL"
      action_final: "WAIT"
      gates_triggered: []
      conflicts_contains: []
      confidence_cap_max: 55
